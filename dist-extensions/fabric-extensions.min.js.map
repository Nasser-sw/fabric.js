{"version":3,"file":"fabric-extensions.min.js","sources":["../extensions/aligning_guidelines/constant.ts","../extensions/aligning_guidelines/util/basic.ts","../extensions/aligning_guidelines/util/collect-point.ts","../extensions/aligning_guidelines/util/draw.ts","../extensions/aligning_guidelines/util/get-objects-by-target.ts","../extensions/aligning_guidelines/util/collect-line.ts","../extensions/data_updaters/origins/index.ts","../extensions/data_updaters/gradient/index.ts","../extensions/aligning_guidelines/index.ts"],"sourcesContent":["import type { AligningLineConfig } from './typedefs';\r\n\r\nexport const aligningLineConfig: AligningLineConfig = {\r\n  /** At what distance from the shape does alignment begin? */\r\n  margin: 4,\r\n  /** Aligning line dimensions */\r\n  width: 1,\r\n  /** Aligning line color */\r\n  color: 'rgb(255,0,0,0.9)',\r\n};\r\n","import type { FabricObject, Point } from 'fabric';\r\n\r\nexport function getDistance(a: number, b: number) {\r\n  return Math.abs(a - b);\r\n}\r\n\r\nexport function setPositionDir(\r\n  target: FabricObject,\r\n  pos: Point,\r\n  dir: 'x' | 'y',\r\n) {\r\n  const center = target.translateToCenterPoint(pos, 'center', 'center');\r\n  const position = target.translateToOriginPoint(\r\n    center,\r\n    target.originX,\r\n    target.originY,\r\n  );\r\n  if (dir == 'x') target.setX(position.x);\r\n  else target.setY(position.y);\r\n}\r\n","import type { FabricObject, Point, TOriginX, TOriginY } from 'fabric';\r\nimport { aligningLineConfig } from '../constant';\r\nimport { getDistance } from './basic';\r\n\r\ntype CollectPointProps = {\r\n  activeObject: FabricObject;\r\n  point: Point;\r\n  list: Point[];\r\n  isScale: boolean;\r\n  index: number;\r\n};\r\nconst originXArr: TOriginX[] = ['left', 'center', 'right'];\r\nconst originYArr: TOriginY[] = ['top', 'center', 'bottom'];\r\n\r\nexport function collectVerticalPoint(props: CollectPointProps) {\r\n  const aligningLineMargin = aligningLineConfig.margin;\r\n  const { activeObject, isScale, index, point, list } = props;\r\n  const { dis, arr } = getDistanceList(point, list, 'x');\r\n  const margin = aligningLineMargin / (activeObject.canvas?.getZoom() ?? 1);\r\n  if (dis > margin) return [];\r\n  let v = arr[arr.length - 1].x - point.x;\r\n  const dir = index == 0 || index == 3 ? -1 : 1;\r\n  v *= dir;\r\n\r\n  const { width, scaleX, left } = activeObject;\r\n  const dim = activeObject._getTransformedDimensions();\r\n  const sx = (v + dim.x) / dim.x;\r\n  if (isScale) activeObject.set('scaleX', scaleX * sx);\r\n  else activeObject.set('width', width * sx);\r\n  const dArr = [0, (v / 2) * dir, v * dir];\r\n  if (dir < 0) dArr.reverse();\r\n  const d = dArr[originXArr.indexOf(activeObject.originX)];\r\n  activeObject.set('left', left + d);\r\n  activeObject.setCoords();\r\n  return arr.map((item) => ({\r\n    x: item.x,\r\n    y1: item.y,\r\n    y2: point.y,\r\n  }));\r\n}\r\n\r\nexport function collectHorizontalPoint(props: CollectPointProps) {\r\n  const aligningLineMargin = aligningLineConfig.margin;\r\n  const { activeObject, isScale, index, point, list } = props;\r\n  const { dis, arr } = getDistanceList(point, list, 'y');\r\n  const margin = aligningLineMargin / (activeObject.canvas?.getZoom() ?? 1);\r\n  if (dis > margin) return [];\r\n  let v = arr[arr.length - 1].y - point.y;\r\n  const dir = index < 2 ? -1 : 1;\r\n  v *= dir;\r\n\r\n  const { height, scaleY, top } = activeObject;\r\n  const dim = activeObject._getTransformedDimensions();\r\n  const sy = (v + dim.y) / dim.y;\r\n  if (isScale) activeObject.set('scaleY', scaleY * sy);\r\n  else activeObject.set('height', height * sy);\r\n  const dArr = [0, (v / 2) * dir, v * dir];\r\n  if (dir < 0) dArr.reverse();\r\n  const d = dArr[originYArr.indexOf(activeObject.originY)];\r\n  activeObject.set('top', top + d);\r\n  activeObject.setCoords();\r\n  return arr.map((item) => ({\r\n    y: item.y,\r\n    x1: item.x,\r\n    x2: point.x,\r\n  }));\r\n}\r\n\r\nfunction getDistanceList(point: Point, list: Point[], type: 'x' | 'y') {\r\n  let dis = Infinity;\r\n  let arr: Point[] = [];\r\n  for (const item of list) {\r\n    const v = getDistance(point[type], item[type]);\r\n    if (dis > v) {\r\n      arr = [];\r\n      dis = v;\r\n    }\r\n    if (dis == v) {\r\n      arr.push(item);\r\n    }\r\n  }\r\n  return { dis, arr };\r\n}\r\n","import type { Canvas } from 'fabric';\r\nimport { Point } from 'fabric';\r\nimport type { HorizontalLine, VerticalLine } from '../typedefs';\r\nimport { aligningLineConfig } from '../constant';\r\n\r\nfunction drawLine(canvas: Canvas, origin: Point, target: Point) {\r\n  const { width, color } = aligningLineConfig;\r\n  const ctx = canvas.getSelectionContext();\r\n  const viewportTransform = canvas.viewportTransform;\r\n  const zoom = canvas.getZoom();\r\n  ctx.save();\r\n  ctx.transform(...viewportTransform);\r\n  ctx.lineWidth = width / zoom;\r\n  ctx.strokeStyle = color;\r\n  ctx.beginPath();\r\n  ctx.moveTo(origin.x, origin.y);\r\n  ctx.lineTo(target.x, target.y);\r\n  ctx.stroke();\r\n  drawX(ctx, zoom, origin);\r\n  drawX(ctx, zoom, target);\r\n  ctx.restore();\r\n}\r\n\r\nconst xSize = 2.4;\r\nfunction drawX(ctx: CanvasRenderingContext2D, zoom: number, point: Point) {\r\n  const size = xSize / zoom;\r\n  ctx.save();\r\n  ctx.translate(point.x, point.y);\r\n  ctx.beginPath();\r\n  ctx.moveTo(-size, -size);\r\n  ctx.lineTo(size, size);\r\n  ctx.moveTo(size, -size);\r\n  ctx.lineTo(-size, size);\r\n  ctx.stroke();\r\n  ctx.restore();\r\n}\r\nfunction drawPoint(canvas: Canvas, arr: Point[]) {\r\n  const { width, color } = aligningLineConfig;\r\n  const ctx = canvas.getSelectionContext();\r\n  const viewportTransform = canvas.viewportTransform;\r\n  const zoom = canvas.getZoom();\r\n  ctx.save();\r\n  ctx.transform(...viewportTransform);\r\n  ctx.lineWidth = width / zoom;\r\n  ctx.strokeStyle = color;\r\n  for (const item of arr) drawX(ctx, zoom, item);\r\n  ctx.restore();\r\n}\r\nexport function drawPointList(\r\n  canvas: Canvas,\r\n  list: Array<VerticalLine | HorizontalLine>,\r\n) {\r\n  const arr = list.map((item) => {\r\n    const isVertical = 'y2' in item;\r\n    const x = isVertical ? item.x : item.x1;\r\n    const y = isVertical ? item.y1 : item.y;\r\n    return new Point(x, y);\r\n  });\r\n  drawPoint(canvas, arr);\r\n}\r\n\r\nexport function drawVerticalLine(canvas: Canvas, coords: VerticalLine) {\r\n  const x = coords.x;\r\n  const origin = new Point(x, coords.y1);\r\n  const target = new Point(x, coords.y2);\r\n  drawLine(canvas, origin, target);\r\n}\r\n\r\nexport function drawHorizontalLine(canvas: Canvas, coords: HorizontalLine) {\r\n  const y = coords.y;\r\n  const origin = new Point(coords.x1, y);\r\n  const target = new Point(coords.x2, y);\r\n  drawLine(canvas, origin, target);\r\n}\r\n","import type { FabricObject } from 'fabric';\r\nimport { ActiveSelection, Group } from 'fabric';\r\n\r\nexport function getObjectsByTarget(target: FabricObject) {\r\n  const objects = new Set<FabricObject>();\r\n  const canvas = target.canvas;\r\n  if (!canvas) return objects;\r\n  const children =\r\n    target instanceof ActiveSelection ? target.getObjects() : [target];\r\n\r\n  canvas.forEachObject((o) => {\r\n    if (!o.isOnScreen()) return;\r\n    if (!o.visible) return;\r\n    if (o.constructor == Group) {\r\n      collectObjectsByGroup(objects, o);\r\n      return;\r\n    }\r\n    objects.add(o);\r\n  });\r\n\r\n  deleteObjectsByList(objects, children);\r\n  return objects;\r\n}\r\n\r\nfunction deleteObjectsByList(objects: Set<FabricObject>, list: FabricObject[]) {\r\n  for (const target of list) {\r\n    if (target.constructor == Group) {\r\n      deleteObjectsByList(objects, (target as Group).getObjects());\r\n    } else {\r\n      objects.delete(target);\r\n    }\r\n  }\r\n}\r\n\r\nfunction collectObjectsByGroup(objects: Set<FabricObject>, g: Group) {\r\n  const children = g.getObjects();\r\n  for (const child of children) {\r\n    if (!child.visible) continue;\r\n    if (child.constructor == Group) {\r\n      collectObjectsByGroup(objects, child);\r\n      continue;\r\n    }\r\n    objects.add(child);\r\n  }\r\n}\r\n","import type { FabricObject, TBBox } from 'fabric';\r\nimport { Point } from 'fabric';\r\nimport type { HorizontalLine, VerticalLine } from '../typedefs';\r\nimport { aligningLineConfig } from '../constant';\r\nimport { getDistance, setPositionDir } from './basic';\r\n\r\ntype CollectLineProps = {\r\n  activeObject: FabricObject;\r\n  activeObjectRect: TBBox;\r\n  objectRect: TBBox;\r\n};\r\n\r\nexport function collectLine(props: CollectLineProps) {\r\n  const aligningLineMargin = aligningLineConfig.margin;\r\n  const { activeObject, activeObjectRect, objectRect } = props;\r\n  const list = makeLineByRect(objectRect);\r\n  const aList = makeLineByRect(activeObjectRect);\r\n  const margin = aligningLineMargin / (activeObject.canvas?.getZoom() ?? 1);\r\n  const opts = { target: activeObject, list, aList, margin };\r\n  const vLines = collectVerticalLine(opts);\r\n  const hLines = collectHorizontalLine(opts);\r\n\r\n  return { vLines, hLines };\r\n}\r\n\r\ntype CollectItemLineProps = {\r\n  target: FabricObject;\r\n  list: LineProps[];\r\n  aList: LineProps[];\r\n  margin: number;\r\n};\r\nfunction collectVerticalLine(props: CollectItemLineProps) {\r\n  const { target, list, aList, margin } = props;\r\n\r\n  const arr = aList.map((x) => getDistanceLine(x, list, 'x'));\r\n  const min = Math.min(...arr.map((x) => x.dis));\r\n  if (min > margin) return [];\r\n  const lines: VerticalLine[] = [];\r\n  const width = aList[0].x2 - aList[0].x;\r\n  const height = aList[0].y2 - aList[0].y;\r\n  let b = false;\r\n  for (let i = 0; i < arr.length; i++) {\r\n    const item = arr[i];\r\n    if (min == item.dis) {\r\n      const line = list[item.index];\r\n      const aLine = aList[item.index];\r\n      const x = line.x;\r\n      const y = aLine.y;\r\n\r\n      const y1 = Math.min(line.y, line.y2, y, aLine.y2);\r\n      const y2 = Math.max(line.y, line.y2, y, aLine.y2);\r\n      // 参考线可画多条\r\n      lines.push({ x, y1, y2 });\r\n      if (b) continue;\r\n      b = true;\r\n      // 对齐只进行一次\r\n      setPos({\r\n        target,\r\n        x,\r\n        y,\r\n        centerX: i - 1,\r\n        centerY: item.index - 1,\r\n        width,\r\n        height,\r\n        dir: 'x',\r\n      });\r\n      const dis = min * item.dir;\r\n      aList.forEach((x) => (x.x -= dis));\r\n    }\r\n  }\r\n  return lines;\r\n}\r\n\r\nfunction collectHorizontalLine(props: CollectItemLineProps) {\r\n  const { target, list, aList, margin } = props;\r\n\r\n  const arr = aList.map((x) => getDistanceLine(x, list, 'y'));\r\n  const min = Math.min(...arr.map((x) => x.dis));\r\n  if (min > margin) return [];\r\n  const lines: HorizontalLine[] = [];\r\n  const width = aList[0].x2 - aList[0].x;\r\n  const height = aList[0].y2 - aList[0].y;\r\n  let b = false;\r\n  for (let i = 0; i < arr.length; i++) {\r\n    const item = arr[i];\r\n    if (min == item.dis) {\r\n      const line = list[item.index];\r\n      const aLine = aList[item.index];\r\n      const y = line.y;\r\n      const x = aLine.x;\r\n\r\n      const x1 = Math.min(line.x, line.x2, x, aLine.x2);\r\n      const x2 = Math.max(line.x, line.x2, x, aLine.x2);\r\n      // 参考线可画多条\r\n      lines.push({ y, x1, x2 });\r\n      if (b) continue;\r\n      b = true;\r\n      // 对齐只进行一次\r\n      setPos({\r\n        target,\r\n        x,\r\n        y,\r\n        centerX: item.index - 1,\r\n        centerY: i - 1,\r\n        width,\r\n        height,\r\n        dir: 'y',\r\n      });\r\n      const dis = min * item.dir;\r\n      aList.forEach((x) => (x.y -= dis));\r\n    }\r\n  }\r\n  return lines;\r\n}\r\n\r\ntype LineProps = {\r\n  x: number;\r\n  y: number;\r\n  x2: number;\r\n  y2: number;\r\n};\r\nfunction getDistanceLine(\r\n  target: LineProps,\r\n  list: LineProps[],\r\n  type: 'x' | 'y',\r\n) {\r\n  let dis = Infinity;\r\n  let index = -1;\r\n  /** 1正值 -1负值 */\r\n  let dir = 1;\r\n  for (let i = 0; i < list.length; i++) {\r\n    const v = getDistance(target[type], list[i][type]);\r\n    if (dis > v) {\r\n      index = i;\r\n      dis = v;\r\n      dir = target[type] > list[i][type] ? 1 : -1;\r\n    }\r\n  }\r\n  return { dis, index, dir };\r\n}\r\n\r\nfunction makeLineByRect(rect: TBBox) {\r\n  const { left, top, width, height } = rect;\r\n  const a = { x: left, y: top, x2: left + width, y2: top + height };\r\n  const x = left + width / 2;\r\n  const y = top + height / 2;\r\n  const b = { x, y, x2: x, y2: y };\r\n  const c = { x: left + width, x2: left, y: top + height, y2: top };\r\n\r\n  return [a, b, c];\r\n}\r\n\r\ntype SnapToPixelProps = {\r\n  target: FabricObject;\r\n  x: number;\r\n  y: number;\r\n  /** -1 0 1 */\r\n  centerX: number;\r\n  /** -1 0 1 */\r\n  centerY: number;\r\n  width: number;\r\n  height: number;\r\n  dir: 'x' | 'y';\r\n};\r\nfunction setPos(props: SnapToPixelProps) {\r\n  const { target, centerX, centerY, width, height, dir } = props;\r\n  let { x, y } = props;\r\n  x -= (centerX * width) / 2;\r\n  y -= (centerY * height) / 2;\r\n  setPositionDir(target, new Point(x, y), dir);\r\n  target.setCoords();\r\n}\r\n","import {\r\n  Point,\r\n  FabricImage,\r\n  Group,\r\n  BaseFabricObject,\r\n  type FabricObject,\r\n  type TOriginX,\r\n  type TOriginY,\r\n} from 'fabric';\r\n\r\n/**\r\n * Updates the fromObject function of a class to return a version that can restore old data\r\n * with values of originX and originY that are different from 'center', 'center'\r\n * Used to upgrade from fabric 6 to fabric 7\r\n * @param originalFn the original fromObject function of an object,\r\n * @param defaultOriginX optional default value for non exported originX,\r\n * @param defaultOriginY optional default value for non exported originY,\r\n * @returns a wrapped fromObject function for the object\r\n */\r\nexport const originUpdaterWrapper = <T extends FabricObject = FabricObject>(\r\n  originalFn: (...args: any[]) => Promise<T>,\r\n  defaultOriginX: TOriginX = 'left',\r\n  defaultOriginY: TOriginY = 'top',\r\n): ((...args: any[]) => Promise<T>) =>\r\n  async function (this: T, serializedObject, ...args) {\r\n    // we default to left and top because those are defaults before deprecation\r\n    const { originX = defaultOriginX, originY = defaultOriginY } =\r\n      serializedObject;\r\n    // and we do not want to pass those properties on the object anymore\r\n    delete serializedObject.originX;\r\n    delete serializedObject.originY;\r\n    const originalObject = await originalFn.call(\r\n      this,\r\n      serializedObject,\r\n      ...args,\r\n    );\r\n    const actualPosition = new Point(originalObject.left, originalObject.top);\r\n    originalObject.setPositionByOrigin(actualPosition, originX, originY);\r\n    return originalObject;\r\n  };\r\n\r\n/**\r\n * Wraps and override the current fabricJS fromObject static functions\r\n * Used to upgrade from fabric 7 to fabric 8\r\n * If you used to export with includeDefaultValues = false, you have to specify\r\n * which were yours default origins values\r\n * @param originX optional default value for non exported originX,\r\n * @param originY optional default value for non exported originY,\r\n */\r\nexport const installOriginWrapperUpdater = (\r\n  originX?: TOriginX,\r\n  originY?: TOriginY,\r\n) => {\r\n  // @ts-expect-error the _fromObject parameter could be instantiated differently\r\n  BaseFabricObject._fromObject = originUpdaterWrapper(\r\n    BaseFabricObject._fromObject,\r\n    originX,\r\n    originY,\r\n  );\r\n  // FabricImage and Group do not use _fromObject\r\n  FabricImage.fromObject = originUpdaterWrapper<FabricImage>(\r\n    FabricImage.fromObject,\r\n    originX,\r\n    originY,\r\n  );\r\n  Group.fromObject = originUpdaterWrapper<Group>(\r\n    Group.fromObject,\r\n    originX,\r\n    originY,\r\n  );\r\n};\r\n","import type { GradientOptions, ColorStop } from 'fabric';\r\nimport { Color, Gradient } from 'fabric';\r\n\r\n/**\r\n * Updates the fromObject function of a Gradient to return a version that can restore old data\r\n * with opactiy in color Stops\r\n * Used to upgrade from fabric 6 to fabric 7\r\n * @param originalFn the original fromObject function of an object,\r\n * @returns a wrapped fromObject function for the object\r\n */\r\n\r\ntype OldColorStop = ColorStop & {\r\n  opacity?: number;\r\n};\r\n\r\nexport const gradientUpdaterWrapper = <S, T extends Gradient<S> = Gradient<S>>(\r\n  originalFn: (\r\n    options: GradientOptions<'linear'> | GradientOptions<'radial'>,\r\n  ) => Promise<T>,\r\n): ((\r\n  options: GradientOptions<'linear'> | GradientOptions<'radial'>,\r\n) => Promise<T>) =>\r\n  async function (this: T, serializedGradient) {\r\n    // we default to left and top because those are defaults before deprecation\r\n    const { colorStops } = serializedGradient;\r\n    // and we do not want to pass those properties on the object anymore\r\n    const newColorStops: ColorStop[] = (\r\n      colorStops as OldColorStop[]\r\n    )?.map<ColorStop>(({ color, opacity, offset }) => {\r\n      if (opacity === undefined || opacity === 1) {\r\n        return {\r\n          color,\r\n          offset,\r\n        };\r\n      }\r\n      const col = new Color(color).setAlpha(opacity).toRgba();\r\n      return {\r\n        color: col,\r\n        offset,\r\n      };\r\n    });\r\n    const gradient = await originalFn.call(this, {\r\n      ...serializedGradient,\r\n      colorStops: newColorStops,\r\n    });\r\n    return gradient;\r\n  };\r\n\r\n/**\r\n * Wraps and override the current fabricJS fromObject static functions\r\n * Used to upgrade from fabric 7 to fabric 8\r\n * If you used to export with includeDefaultValues = false, you have to specify\r\n * which were yours default origins values\r\n */\r\nexport const installGradientUpdater = () => {\r\n  // @ts-expect-error untypable\r\n  Gradient.fromObject = gradientUpdaterWrapper(Gradient.fromObject);\r\n};\r\n","import type {\r\n  BasicTransformEvent,\r\n  Canvas,\r\n  FabricObject,\r\n  TBBox,\r\n  TPointerEvent,\r\n} from 'fabric';\r\nimport { Point, util } from 'fabric';\r\nimport {\r\n  collectHorizontalPoint,\r\n  collectVerticalPoint,\r\n} from './util/collect-point';\r\nimport {\r\n  drawHorizontalLine,\r\n  drawPointList,\r\n  drawVerticalLine,\r\n} from './util/draw';\r\nimport { getObjectsByTarget } from './util/get-objects-by-target';\r\nimport { collectLine } from './util/collect-line';\r\nimport type {\r\n  AligningLineConfig,\r\n  HorizontalLine,\r\n  VerticalLine,\r\n} from './typedefs';\r\nimport { aligningLineConfig } from './constant';\r\n\r\ntype TransformEvent = BasicTransformEvent<TPointerEvent> & {\r\n  target: FabricObject;\r\n};\r\n\r\nexport type { AligningLineConfig } from './typedefs';\r\n\r\nexport function initAligningGuidelines(\r\n  canvas: Canvas,\r\n  options: Partial<AligningLineConfig> = {},\r\n) {\r\n  Object.assign(aligningLineConfig, options);\r\n\r\n  const horizontalLines = new Set<string>();\r\n  const verticalLines = new Set<string>();\r\n  let onlyDrawPoint = false;\r\n  const cacheMap = new Map<string, [TBBox, Point[]]>();\r\n\r\n  const getCaCheMapValue = (object: FabricObject) => {\r\n    const cacheKey = [\r\n      object.calcTransformMatrix().toString(),\r\n      object.width,\r\n      object.height,\r\n    ].join();\r\n    const cacheValue = cacheMap.get(cacheKey);\r\n    if (cacheValue) return cacheValue;\r\n    const coords = object.getCoords();\r\n    const rect = util.makeBoundingBoxFromPoints(coords);\r\n    const value: [TBBox, Point[]] = [rect, coords];\r\n    cacheMap.set(cacheKey, value);\r\n    return value;\r\n  };\r\n\r\n  function moving(e: TransformEvent) {\r\n    const activeObject = e.target;\r\n    activeObject.setCoords();\r\n    onlyDrawPoint = false;\r\n    verticalLines.clear();\r\n    horizontalLines.clear();\r\n\r\n    const objects = getObjectsByTarget(activeObject);\r\n    const activeObjectRect = activeObject.getBoundingRect();\r\n\r\n    for (const object of objects) {\r\n      const objectRect = getCaCheMapValue(object)[0];\r\n      const { vLines, hLines } = collectLine({\r\n        activeObject,\r\n        activeObjectRect,\r\n        objectRect,\r\n      });\r\n      vLines.forEach((o) => {\r\n        verticalLines.add(JSON.stringify(o));\r\n      });\r\n      hLines.forEach((o) => {\r\n        horizontalLines.add(JSON.stringify(o));\r\n      });\r\n    }\r\n  }\r\n\r\n  function scalingOrResizing(e: TransformEvent) {\r\n    // br bl tr tl mb ml mt mr\r\n    const activeObject = e.target;\r\n    activeObject.setCoords();\r\n    const isScale = String(e.transform.action).startsWith('scale');\r\n    verticalLines.clear();\r\n    horizontalLines.clear();\r\n\r\n    const objects = getObjectsByTarget(activeObject);\r\n    let corner = e.transform.corner;\r\n    if (activeObject.flipX) corner = corner.replace('l', 'r').replace('r', 'l');\r\n    if (activeObject.flipY) corner = corner.replace('t', 'b').replace('b', 't');\r\n    let index = ['tl', 'tr', 'br', 'bl', 'mt', 'mr', 'mb', 'ml'].indexOf(\r\n      corner,\r\n    );\r\n    if (index == -1) return;\r\n    onlyDrawPoint = index > 3;\r\n    if (onlyDrawPoint) {\r\n      const angle = activeObject.getTotalAngle();\r\n      if (angle % 90 != 0) return;\r\n      index -= 4;\r\n    }\r\n    let point = activeObject.getCoords()[index];\r\n    for (const object of objects) {\r\n      const [rect, coords] = getCaCheMapValue(object);\r\n      const center = new Point(\r\n        rect.left + rect.width / 2,\r\n        rect.top + rect.height / 2,\r\n      );\r\n      const list = [...coords, center];\r\n      const props = { activeObject, point, list, isScale, index };\r\n      const vLines = collectVerticalPoint(props);\r\n      const hLines = collectHorizontalPoint(props);\r\n      vLines.forEach((o) => {\r\n        verticalLines.add(JSON.stringify(o));\r\n      });\r\n      hLines.forEach((o) => {\r\n        horizontalLines.add(JSON.stringify(o));\r\n      });\r\n      if (vLines.length || hLines.length)\r\n        point = activeObject.getCoords()[index];\r\n    }\r\n  }\r\n\r\n  function beforeRender() {\r\n    canvas.clearContext(canvas.contextTop);\r\n  }\r\n  function afterRender() {\r\n    if (onlyDrawPoint) {\r\n      const list: Array<VerticalLine | HorizontalLine> = [];\r\n      for (const v of verticalLines) list.push(JSON.parse(v));\r\n      for (const h of horizontalLines) list.push(JSON.parse(h));\r\n      drawPointList(canvas, list);\r\n    } else {\r\n      for (const v of verticalLines) drawVerticalLine(canvas, JSON.parse(v));\r\n      for (const h of horizontalLines)\r\n        drawHorizontalLine(canvas, JSON.parse(h));\r\n    }\r\n  }\r\n  function mouseUp() {\r\n    verticalLines.clear();\r\n    horizontalLines.clear();\r\n    cacheMap.clear();\r\n    canvas.requestRenderAll();\r\n  }\r\n\r\n  canvas.on('object:resizing', scalingOrResizing);\r\n  canvas.on('object:scaling', scalingOrResizing);\r\n  canvas.on('object:moving', moving);\r\n  canvas.on('before:render', beforeRender);\r\n  canvas.on('after:render', afterRender);\r\n  canvas.on('mouse:up', mouseUp);\r\n\r\n  return () => {\r\n    canvas.off('object:resizing', scalingOrResizing);\r\n    canvas.off('object:scaling', scalingOrResizing);\r\n    canvas.off('object:moving', moving);\r\n    canvas.off('before:render', beforeRender);\r\n    canvas.off('after:render', afterRender);\r\n    canvas.off('mouse:up', mouseUp);\r\n  };\r\n}\r\n"],"names":["aligningLineConfig","margin","width","color","getDistance","a","b","Math","abs","originXArr","originYArr","collectVerticalPoint","props","_activeObject$canvas$","_activeObject$canvas","aligningLineMargin","activeObject","isScale","index","point","list","dis","arr","getDistanceList","canvas","getZoom","v","length","x","dir","scaleX","left","dim","_getTransformedDimensions","sx","set","dArr","reverse","d","indexOf","originX","setCoords","map","item","y1","y","y2","collectHorizontalPoint","_activeObject$canvas$2","_activeObject$canvas2","height","scaleY","top","sy","originY","x1","x2","type","Infinity","push","drawLine","origin","target","ctx","getSelectionContext","viewportTransform","zoom","save","transform","lineWidth","strokeStyle","beginPath","moveTo","lineTo","stroke","drawX","restore","xSize","size","translate","drawPointList","drawPoint","isVertical","Point","drawVerticalLine","coords","drawHorizontalLine","getObjectsByTarget","objects","Set","children","ActiveSelection","getObjects","forEachObject","o","isOnScreen","visible","constructor","Group","add","collectObjectsByGroup","deleteObjectsByList","delete","g","child","collectLine","activeObjectRect","objectRect","opts","makeLineByRect","aList","vLines","getDistanceLine","min","lines","i","line","aLine","max","setPos","centerX","centerY","forEach","collectVerticalLine","hLines","collectHorizontalLine","rect","pos","center","translateToCenterPoint","position","translateToOriginPoint","setX","setY","setPositionDir","originUpdaterWrapper","originalFn","defaultOriginX","arguments","undefined","defaultOriginY","async","serializedObject","_len","args","Array","_key","originalObject","call","this","actualPosition","setPositionByOrigin","gradientUpdaterWrapper","serializedGradient","colorStops","newColorStops","_ref","opacity","offset","Color","setAlpha","toRgba","options","Object","assign","horizontalLines","verticalLines","onlyDrawPoint","cacheMap","Map","getCaCheMapValue","object","cacheKey","calcTransformMatrix","toString","join","cacheValue","get","getCoords","value","util","makeBoundingBoxFromPoints","moving","e","clear","getBoundingRect","JSON","stringify","scalingOrResizing","String","action","startsWith","corner","flipX","replace","flipY","getTotalAngle","beforeRender","clearContext","contextTop","afterRender","parse","h","mouseUp","requestRenderAll","on","off","installGradientUpdater","Gradient","fromObject","installOriginWrapperUpdater","BaseFabricObject","_fromObject","FabricImage"],"mappings":"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"}